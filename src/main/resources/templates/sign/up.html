<!DOCTYPE html>
<html lang="ko"
      layout:decorate="~{layout/sign-layout.html}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
  <title>IKEA - 회원가입</title>
</head>
<body>

<section layout:fragment="container">
  <div class="left-area">
    <button class="go-back-btn">
      <i class="fa-solid fa-arrow-left"></i>
    </button>
    <div class="left-area-header">
      <img alt="메인 로고" th:src="@{/img/ikea/blue-logo.svg}"/>
    </div>
    <div class="left-area-section">
      <h2>회원가입</h2>
      <p>이케아에 가입하여 새로운 가구를 장만해보세요.</p>
      <p>* 주소는 배송을 위해 정확하게 입력해주세요.</p>
    </div>
    <div class="left-area-footer">
      <p>&copy; IKEA</p>
    </div>
  </div>
  <div class="right-area">
    <div class="form-area">
      <form class="sign-up-form">
        <div class="input-area">
          <label for="username">아이디</label>
          <input id="username" name="username" type="text">
        </div>
        <div class="input-area">
          <label for="password">비밀번호</label>
          <input id="password" name="password" type="password">
        </div>
        <div class="input-area">
          <label for="checkPassword">비밀번호 확인</label>
          <input id="checkPassword" name="checkPassword" type="password">
        </div>
        <div class="input-area">
          <label for="name">이 름</label>
          <input id="name" name="name" type="text">
        </div>
        <div class="input-area">
          <label for="email">이메일</label>
          <input id="email" name="email" type="text">
        </div>
        <div class="input-area">
          <label for="address">주 소</label>
          <input id="address" name="address" type="text">
        </div>
        <div class="input-area">
          <label for="mobile">전화번호</label>
          <input id="mobile" name="mobile" type="text">
        </div>
        <div class="blue-btn-area">
          <button class="sign-up-btn">회원가입</button>
        </div>
        <div class="white-btn-area">
          <button class="sign-in-btn">로그인</button>
        </div>
      </form>
    </div>
  </div>
</section>

</body>
</html>

<script>
  const $goBackBtn = $('.go-back-btn')
  const $signUpForm = $('.sign-up-form')
  const $usernameInput = $('input[name=username]')
  const $passwordInput = $('input[name=password]')
  const $nameInput = $('input[name=name]')
  const $emailInput = $('input[name=email]')
  const $addressInput = $('input[name=address]')
  const $mobileInput = $('input[name=mobile]')
  const $signUpBtn = $('.sign-up-btn')
  const $signInBtn = $('.sign-in-btn')

  $signUpForm.validate({
    rules: {
      username: {
        required: true
      },
      password: {
        required: true
      },
      checkPassword: {
        required: true,
        equalTo: '[name=password]'
      },
      name: {
        required: true
      },
      email: {
        required: true,
        email: true
      },
      address: {
        required: true
      },
      mobile: {
        required: true
      }
    },
    messages: {
      username: {
        required: '아이디가 입력되지 않았습니다.'
      },
      password: {
        required: '비밀번호가 입력되지 않았습니다.'
      },
      checkPassword: {
        required: '확인 비밀번호가 입력되지 않았습니다.',
        equalTo: '비밀번호가 일치하지 않습니다.'
      },
      name: {
        required: '이름이 입력되지 않았습니다.'
      },
      email: {
        required: '이메일이 입력되지 않았습니다.',
        email: '이메일 형식이 올바르지 않습니다.'
      },
      address: {
        required :'주소가 입력되지 않았습니다.'
      },
      mobile: {
        required: '전화번호가 입력되지 않았습니다.'
      }
    },
    submitHandler: () => {
      $.ajax({
        url: 'http://localhost:8080/api/sign/up',
        type: 'POST',
        contentType: 'application/json',
        dataType: 'json',
        data: JSON.stringify({
          username: $usernameInput.val(),
          password: $passwordInput.val(),
          name: $nameInput.val(),
          email: $emailInput.val(),
          address: $addressInput.val(),
          mobile: $mobileInput.val()
        }),
        success: () => {
          alert('[회원 가입 성공]\n로그인 페이지로 이동합니다.')
          location.href = '/sign/in'
        },
        error: (request) => {
          console.log(request)
        }
      })
    }
  })
  $goBackBtn.on('click', (e) => {
    e.preventDefault()
    location.href = '/'
  })
  $signUpBtn.on('click', (e) => {
    e.preventDefault()
    $signUpForm.submit()
  })
  $signInBtn.on('click', (e) => {
    e.preventDefault()
    location.href = '/sign/in'
  })
</script>